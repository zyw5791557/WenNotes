<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>给localStorage添加过期时间函数</title>
<!--defaultCSS-->
</head>

<body>
<div id="WizHtmlContentId">

<!--WizHtmlContentBegin--><div><span style="color: rgb(51, 51, 51); font-family: 'Source Code Pro', monospace; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: pre; widows: 2; background-color: rgba(128, 128, 128, 0.0470588);"> </span><span class="hljs-tag" style="color: rgb(0, 102, 102); box-sizing: border-box; font-family: 'Source Code Pro', monospace; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: pre; widows: 2; background-color: rgba(128, 128, 128, 0.0470588);">&lt;<span class="hljs-title" style="box-sizing: border-box; color: rgb(0, 0, 136);">script</span> <span class="hljs-attribute" style="box-sizing: border-box; color: rgb(102, 0, 102);">type</span>=<span class="hljs-value" style="box-sizing: border-box; color: rgb(0, 136, 0);">"text/javascript"</span>&gt;</span><span class="javascript" style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Source Code Pro', monospace; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: pre; widows: 2; background-color: rgba(128, 128, 128, 0.0470588);"><span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">//封装过期控制代码</span><span class="hljs-function" style="box-sizing: border-box;"><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">function</span> <span class="hljs-title" style="box-sizing: border-box;">set</span><span class="hljs-params" style="color: rgb(102, 0, 102); box-sizing: border-box;">(key,value)</span>{</span><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">var</span> curTime = <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">new</span> <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">Date</span>().getTime();
        localStorage.setItem(key,<span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">JSON</span>.stringify({data:value,time:curTime}));
    }
    <span class="hljs-function" style="box-sizing: border-box;"><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">function</span> <span class="hljs-title" style="box-sizing: border-box;">get</span><span class="hljs-params" style="color: rgb(102, 0, 102); box-sizing: border-box;">(key,exp)</span>{</span><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">var</span> data = localStorage.getItem(key);
        <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">var</span> dataObj = <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">JSON</span>.parse(data);
        <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">if</span> (<span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">new</span> <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">Date</span>().getTime() - dataObj.time&gt;exp) {
            console.log(<span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box;">'信息已过期'</span>);
            <span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">//alert("信息已过期")</span>
        }<span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">else</span>{
            <span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">//console.log("data="+dataObj.data);</span><span class="hljs-comment" style="color: rgb(136, 0, 0); box-sizing: border-box;">//console.log(JSON.parse(dataObj.data));</span><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">var</span> dataObjDatatoJson = <span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box;">JSON</span>.parse(dataObj.data)
            <span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box;">return</span> dataObjDatatoJson;
        }
    }
 </span><span class="hljs-tag" style="box-sizing: border-box; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgba(128, 128, 128, 0.0470588);"><font color="#006666" style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre;">&lt;/</font><span class="hljs-title" style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: rgb(0, 0, 136); box-sizing: border-box;">script</span><font color="#006666" style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre;">&gt;<br></font><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><small>来源：&nbsp;<a href="http://blog.csdn.net/xyphf/article/details/51830770">http://blog.csdn.net/xyphf/article/details/51830770</a></small></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><br></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><br></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><br></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">&lt;script&gt;
</span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">window</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.onload = </span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">function</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">(){
    </span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> Ipt = </span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">document</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.getElementById(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'input1'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);
    </span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> value = </span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'{"name":"和派孔明","Age":"18","address":"陆家嘴金融城"}'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">;
    set(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,value);

    Ipt.onclick = </span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">function</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">(){
        </span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> dataObjData=get(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1000</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);</span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">过期时间为</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">秒,正常情况下，你点击的时候已经过期
        </span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> dataObjData=get(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1000</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);</span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">过期时间为</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">分钟
        </span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> dataObjData=get(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1000</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);</span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">过期时间为</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">小时
        </span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> Obj=get(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1000</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">24</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);</span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">过期时间为</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">24</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">小时
        </span><span class="hljs-reserved" style="box-sizing: border-box; color: rgb(51, 51, 51); font-variant-ligatures: normal;">var</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> dataObjData=get(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">'information'</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">,</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1000</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">60</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">24</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">*</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">7</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);</span><span class="hljs-regexp" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">//</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">过期时间为</span><span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">1</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">周
        </span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">console</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.log(dataObjData || </span><span class="hljs-literal" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">null</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);
            </span><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box; font-variant-ligatures: normal;">if</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> (dataObjData!=</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">""</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"> &amp;&amp; dataObjData!=</span><span class="hljs-literal" style="color: rgb(0, 102, 102); box-sizing: border-box; font-variant-ligatures: normal;">null</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">) {
                    </span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">console</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.log(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">"姓名:"</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">+dataObjData.name);
                    </span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">console</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.log(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">"年龄:"</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">+dataObjData.Age );
                    </span><span class="hljs-built_in" style="color: rgb(102, 0, 102); box-sizing: border-box; font-variant-ligatures: normal;">console</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">.log(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">"地址:"</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">+dataObjData.Age );
            }</span><span class="hljs-keyword" style="color: rgb(0, 0, 136); box-sizing: border-box; font-variant-ligatures: normal;">else</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">{
                alert(</span><span class="hljs-string" style="color: rgb(0, 136, 0); box-sizing: border-box; font-variant-ligatures: normal;">"获取的信息已经过期"</span><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;">);
            }   
    }
}
&lt;/script&gt;</span><br></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre;"><font color="#333333"><span data-wiz-span="data-wiz-span" style="color: rgb(255, 0, 0); font-size: 1.467rem;"><b>改良</b></span></font></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div><span style="font-variant-ligatures: normal;"><font color="#333333" face="Source Code Pro, monospace"><span style="font-size: 14px; line-height: 22.4px; white-space: pre;"><span data-wiz-span="data-wiz-span" style="font-size: 1.267rem;"><b>let setLocalStorage = function(key, value, exp) {
	var curTime = new Date().getTime();
	curTime = exp + curTime;
    localStorage.setItem(key,JSON.stringify({data:value,time:curTime}));
};

let getLocalStorage = function(key) {
	var data = localStorage.getItem(key);
    var dataObj = JSON.parse(data);
    if (new Date().getTime() - dataObj.time &gt; 0) {
        console.log('信息已过期');
    }else{
        var dataObjDatatoJson = JSON.parse(dataObj.data)
        return dataObjDatatoJson;
    }
}</b></span></span></font><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div><div style="font-family: 'Source Code Pro', monospace; font-size: 14px; white-space: pre; color: gray;"><span style="color: rgb(51, 51, 51); font-variant-ligatures: normal;"><br></span></div></span><br></div><!--WizHtmlContentEnd-->

</div>
</body>

</html>