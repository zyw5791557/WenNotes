<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>彻底弄懂CommonJS和AMD/CMD！</title>
<!--defaultCSS-->
</head>

<body>
<div id="WizHtmlContentId">

<!--WizHtmlContentBegin--><div>-&nbsp;<a href="http://www.cnblogs.com/chenguangliang/p/5856701.html">http://www.cnblogs.com/chenguangliang/p/5856701.html</a>&nbsp;&nbsp;</div><div>-&nbsp;<a href="http://javascript.ruanyifeng.com/nodejs/module.html#">http://javascript.ruanyifeng.com/nodejs/module.html#</a>&nbsp; &nbsp;阮一峰</div><div><br></div><div><h1 class="postTitle" style="margin-top: 0px; margin-bottom: 20px; font-size: 28px; font-weight: 400; line-height: 1.8; color: rgb(51, 51, 51); font-family: 'Microsoft YaHei'; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/chenguangliang/p/5856701.html" style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); text-decoration: none;">彻底弄懂CommonJS和AMD/CMD！</a></h1><div class="clear" style="padding: 0px; clear: both; color: rgb(125, 139, 141); font-family: 'Microsoft YaHei'; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"></div><div class="postBody" style="padding: 0px; color: rgb(125, 139, 141); font-family: 'Microsoft YaHei'; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);"><div id="cnblogs_post_body" style="margin-bottom: 20px; padding: 0px; word-break: break-word; color: rgb(51, 51, 51); line-height: 1.8;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">JS中的模块规范（CommonJS，AMD，CMD），如果你听过js模块化这个东西，那么你就应该听过或CommonJS或AMD甚至是CMD这些规范咯，我也听过，但之前也真的是听听而已。<span style="margin: 0px; padding: 0px; line-height: 1.5;">&nbsp;现在就看看吧，这些规范到底是啥东西，干嘛的。本文包括这三个规范的来源及对应的产物的原理。</span></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; font-size: 18pt;">一、CommonJS</span></strong></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">1.一开始大家都认为JS是辣鸡，没什么用，官方定义的API只能构建基于浏览器的应用程序，逗我呢，这太狭隘了吧(用了个高端词，嘎嘎)，CommonJS就按耐不住了，CommonJS API定义很多普通应用程序（主要指非浏览器的应用）使用的API，从而填补了这个空白。它的终极目标是提供一个类似Python，Ruby和Java标准库。这样的话，开发者可以使用CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">在兼容CommonJS的系统中，你可以使用JavaScript开发以下程序：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">(1).服务器端JavaScript应用程序</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">(2).命令行工具</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">(3).图形界面应用程序</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">(4).混合应用程序（如，Titanium或Adobe AIR）</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">2009年，美国程序员Ryan Dahl创造了<a href="http://nodejs.org/" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">node.js</a>项目，将javascript语言用于服务器端编程。这标志"Javascript模块化编程"正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。</span></p><div style="padding: 0px;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">node.js的<a href="http://nodejs.org/docs/latest/api/modules.html" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">模块系统</a>，就是参照<a href="http://wiki.commonjs.org/wiki/Modules/1.1" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">CommonJS</a>规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">var math = require('math');</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">然后，就可以调用模块提供的方法：</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　var math = require('math');</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">&nbsp; &nbsp; &nbsp; math.add(2,3); // 5</span></p></blockquote></div><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">CommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">虽说Node遵循CommonJS的规范，但是相比也是做了一些取舍，填了一些新东西的。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">不过，说了CommonJS也说了Node，那么我觉得也得先了解下NPM了。NPM作为Node的包管理器，不是为了帮助Node解决依赖包的安装问题嘛，那它肯定也要遵循CommonJS规范啦，它遵循包规范（还是理论）的。<a href="http://en.wikipedia.org/wiki/CommonJS" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">CommonJS WIKI</a>讲了它的历史，还介绍了modules和packages等。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">下面讲讲commonJS的原理以及简易实现：</span></p><h2 style="margin-top: 20px; margin-bottom: 20px; font-size: 21px; line-height: 1.5;"><span style="margin: 0px; padding: 0px; font-size: 16px;">1、原理</span></h2><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">浏览器不兼容CommonJS的根本原因，在于缺少四个Node.js环境的变量。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><ul style="margin-bottom: 1em; margin-left: 25px; padding: 0px;"><li style="padding: 0px; list-style-type: disc;"><span style="margin: 0px; padding: 0px;">module</span></li><li style="padding: 0px; list-style-type: disc;"><span style="margin: 0px; padding: 0px;">exports</span></li><li style="padding: 0px; list-style-type: disc;"><span style="margin: 0px; padding: 0px;">require</span></li><li style="padding: 0px; list-style-type: disc;"><span style="margin: 0px; padding: 0px;">global</span></li></ul></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">只要能够提供这四个变量，浏览器就能加载 CommonJS 模块。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">下面是一个简单的示例。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-javascript" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-javascript" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
<span class="token keyword" style="margin: 0px; padding: 0px;">var module <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token punctuation" style="margin: 0px; padding: 0px;">{
  exports<span class="token punctuation" style="margin: 0px; padding: 0px;">: <span class="token punctuation" style="margin: 0px; padding: 0px;">{<span class="token punctuation" style="margin: 0px; padding: 0px;">}
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;

<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token keyword" style="margin: 0px; padding: 0px;">function<span class="token punctuation" style="margin: 0px; padding: 0px;">(module<span class="token punctuation" style="margin: 0px; padding: 0px;">, exports<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
  exports<span class="token punctuation" style="margin: 0px; padding: 0px;">.multiply <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function <span class="token punctuation" style="margin: 0px; padding: 0px;">(n<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{ <span class="token keyword" style="margin: 0px; padding: 0px;">return n <span class="token operator" style="margin: 0px; padding: 0px;">* <span class="token number" style="margin: 0px; padding: 0px;">1000 <span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">(module<span class="token punctuation" style="margin: 0px; padding: 0px;">, module<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">)

<span class="token keyword" style="margin: 0px; padding: 0px;">var f <span class="token operator" style="margin: 0px; padding: 0px;">= module<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">.multiply<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token function" style="margin: 0px; padding: 0px;">f<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token number" style="margin: 0px; padding: 0px;">5<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token comment" style="margin: 0px; padding: 0px;"> // 5000 
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">上面代码向一个立即执行函数提供 module 和 exports 两个外部变量，模块就放在这个立即执行函数里面。模块的输出值放在 module.exports 之中，这样就实现了模块的加载。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><h2 style="margin-top: 20px; margin-bottom: 20px; font-size: 21px; line-height: 1.5;"><span style="margin: 0px; padding: 0px; font-size: 16px;">2、Browserify 的实现</span></h2><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">知道了原理，就能做出工具了。<a href="http://browserify.org/" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">Browserify</a>&nbsp;是目前最常用的 CommonJS 格式转换的工具。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">请看一个例子，main.js 模块加载 foo.js 模块。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-javascript" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-javascript" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;"><span class="token comment" style="margin: 0px; padding: 0px;">
// foo.js
module<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function<span class="token punctuation" style="margin: 0px; padding: 0px;">(x<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
  console<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">log<span class="token punctuation" style="margin: 0px; padding: 0px;">(x<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token comment" style="margin: 0px; padding: 0px;">
// main.js
<span class="token keyword" style="margin: 0px; padding: 0px;">var foo <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token function" style="margin: 0px; padding: 0px;">require<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">"./foo"<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token function" style="margin: 0px; padding: 0px;">foo<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">"Hi"<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用下面的命令，就能将main.js转为浏览器可用的格式。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-bash" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-bash" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
$ browserify main<span class="token punctuation" style="margin: 0px; padding: 0px;">.js <span class="token operator" style="margin: 0px; padding: 0px;">&gt; compiled<span class="token punctuation" style="margin: 0px; padding: 0px;">.js
</span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">Browserify到底做了什么？安装一下<a href="https://www.npmjs.com/package/browser-unpack" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">browser-unpack</a>，就能看清楚了。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-bash" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-bash" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
$ npm install browser<span class="token operator" style="margin: 0px; padding: 0px;">-unpack <span class="token operator" style="margin: 0px; padding: 0px;">-g
</span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">然后，将前面生成的compile.js解包。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-bash" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-bash" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
$ browser<span class="token operator" style="margin: 0px; padding: 0px;">-unpack <span class="token operator" style="margin: 0px; padding: 0px;">&lt; compiled<span class="token punctuation" style="margin: 0px; padding: 0px;">.js

<span class="token punctuation" style="margin: 0px; padding: 0px;">[
  <span class="token punctuation" style="margin: 0px; padding: 0px;">{
    <span class="token string" style="margin: 0px; padding: 0px;">"id"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token number" style="margin: 0px; padding: 0px;">1<span class="token punctuation" style="margin: 0px; padding: 0px;">,
    <span class="token string" style="margin: 0px; padding: 0px;">"source"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token string" style="margin: 0px; padding: 0px;">"module.exports = function(x) {\n  console.log(x);\n};"<span class="token punctuation" style="margin: 0px; padding: 0px;">,
    <span class="token string" style="margin: 0px; padding: 0px;">"deps"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token punctuation" style="margin: 0px; padding: 0px;">{<span class="token punctuation" style="margin: 0px; padding: 0px;">}
  <span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">,
  <span class="token punctuation" style="margin: 0px; padding: 0px;">{
    <span class="token string" style="margin: 0px; padding: 0px;">"id"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token number" style="margin: 0px; padding: 0px;">2<span class="token punctuation" style="margin: 0px; padding: 0px;">,
    <span class="token string" style="margin: 0px; padding: 0px;">"source"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token string" style="margin: 0px; padding: 0px;">"var foo = require(\"./foo\");\nfoo(\"Hi\");"<span class="token punctuation" style="margin: 0px; padding: 0px;">,
    <span class="token string" style="margin: 0px; padding: 0px;">"deps"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token punctuation" style="margin: 0px; padding: 0px;">{<span class="token string" style="margin: 0px; padding: 0px;">"./foo"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token number" style="margin: 0px; padding: 0px;">1<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">,
    <span class="token string" style="margin: 0px; padding: 0px;">"entry"<span class="token punctuation" style="margin: 0px; padding: 0px;">:<span class="token boolean" style="margin: 0px; padding: 0px;">true
  <span class="token punctuation" style="margin: 0px; padding: 0px;">}
<span class="token punctuation" style="margin: 0px; padding: 0px;">]
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">可以看到，browerify 将所有模块放入一个数组，id 属性是模块的编号，source 属性是模块的源码，deps 属性是模块的依赖。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">因为 main.js 里面加载了 foo.js，所以 deps 属性就指定 ./foo 对应1号模块。执行的时候，浏览器遇到 require('./foo') 语句，就自动执行1号模块的 source 属性，并将执行后的 module.exports 属性值输出。</span></p><p style="margin: 10px auto; padding: 0px;">&nbsp;</p><h2 style="margin-top: 20px; margin-bottom: 20px; font-size: 21px; line-height: 1.5;"><span style="margin: 0px; padding: 0px; font-size: 16px;">3、Tiny Browser Require</span></h2><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">我根据&nbsp;<a href="https://github.com/mochajs/mocha" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">mocha</a>&nbsp;的内部实现，做了一个纯浏览器的 CommonJS 模块加载器&nbsp;<a href="https://github.com/ruanyf/tiny-browser-require" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">tiny-browser-require</a>&nbsp;。完全不需要命令行，直接放进浏览器即可，所有代码只有30多行。</span></p><p style="margin: 10px auto; padding: 0px;">&nbsp;</p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><a href="https://github.com/ruanyf/tiny-browser-require" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);"><iframe id="iframe_0.577345986829074" src="data:text/html;charset=utf8,<style>body{margin:0;padding:0}</style><img id=&quot;img&quot; src=&quot;http://image.beekka.com/blog/2015/bg2015052203.png?_=5856701&quot; style=&quot;border:none;max-width:848px&quot;><script>window.onload = function () {var img = document.getElementById('img'); window.parent.postMessage({iframeId:'iframe_0.577345986829074',width:img.width,height:img.height}, 'http://www.cnblogs.com');}</script>" frameborder="0" scrolling="no" style="margin: 0px; padding: 0px; border-style: none; border-width: initial; width: 600px; height: 485px;"></iframe></a></span></p><p style="margin: 10px auto; padding: 0px;">&nbsp;</p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">它的逻辑非常简单，就是把模块读入数组，加载路径就是模块的id。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-javascript" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-javascript" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
<span class="token keyword" style="margin: 0px; padding: 0px;">function <span class="token function" style="margin: 0px; padding: 0px;">require<span class="token punctuation" style="margin: 0px; padding: 0px;">(p<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">{
  <span class="token keyword" style="margin: 0px; padding: 0px;">var path <span class="token operator" style="margin: 0px; padding: 0px;">= require<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">resolve<span class="token punctuation" style="margin: 0px; padding: 0px;">(p<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">var mod <span class="token operator" style="margin: 0px; padding: 0px;">= require<span class="token punctuation" style="margin: 0px; padding: 0px;">.modules<span class="token punctuation" style="margin: 0px; padding: 0px;">[path<span class="token punctuation" style="margin: 0px; padding: 0px;">]<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">if <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token operator" style="margin: 0px; padding: 0px;">!mod<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token keyword" style="margin: 0px; padding: 0px;">throw <span class="token keyword" style="margin: 0px; padding: 0px;">new <span class="token class-name" style="margin: 0px; padding: 0px;">Error<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'failed to require "' <span class="token operator" style="margin: 0px; padding: 0px;">+ p <span class="token operator" style="margin: 0px; padding: 0px;">+ <span class="token string" style="margin: 0px; padding: 0px;">'"'<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">if <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token operator" style="margin: 0px; padding: 0px;">!mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
    mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token punctuation" style="margin: 0px; padding: 0px;">{<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
    mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">call<span class="token punctuation" style="margin: 0px; padding: 0px;">(mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">, mod<span class="token punctuation" style="margin: 0px; padding: 0px;">, mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">, require<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">relative<span class="token punctuation" style="margin: 0px; padding: 0px;">(path<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token punctuation" style="margin: 0px; padding: 0px;">}
  <span class="token keyword" style="margin: 0px; padding: 0px;">return mod<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}

require<span class="token punctuation" style="margin: 0px; padding: 0px;">.modules <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token punctuation" style="margin: 0px; padding: 0px;">{<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;

require<span class="token punctuation" style="margin: 0px; padding: 0px;">.resolve <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function <span class="token punctuation" style="margin: 0px; padding: 0px;">(path<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">{
  <span class="token keyword" style="margin: 0px; padding: 0px;">var orig <span class="token operator" style="margin: 0px; padding: 0px;">= path<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">var reg <span class="token operator" style="margin: 0px; padding: 0px;">= path <span class="token operator" style="margin: 0px; padding: 0px;">+ <span class="token string" style="margin: 0px; padding: 0px;">'.js'<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">var index <span class="token operator" style="margin: 0px; padding: 0px;">= path <span class="token operator" style="margin: 0px; padding: 0px;">+ <span class="token string" style="margin: 0px; padding: 0px;">'/index.js'<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token keyword" style="margin: 0px; padding: 0px;">return require<span class="token punctuation" style="margin: 0px; padding: 0px;">.modules<span class="token punctuation" style="margin: 0px; padding: 0px;">[reg<span class="token punctuation" style="margin: 0px; padding: 0px;">] <span class="token operator" style="margin: 0px; padding: 0px;">&amp;&amp; reg
    <span class="token operator" style="margin: 0px; padding: 0px;">|| require<span class="token punctuation" style="margin: 0px; padding: 0px;">.modules<span class="token punctuation" style="margin: 0px; padding: 0px;">[index<span class="token punctuation" style="margin: 0px; padding: 0px;">] <span class="token operator" style="margin: 0px; padding: 0px;">&amp;&amp; index
    <span class="token operator" style="margin: 0px; padding: 0px;">|| orig<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;

require<span class="token punctuation" style="margin: 0px; padding: 0px;">.register <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function <span class="token punctuation" style="margin: 0px; padding: 0px;">(path<span class="token punctuation" style="margin: 0px; padding: 0px;">, fn<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">{
  require<span class="token punctuation" style="margin: 0px; padding: 0px;">.modules<span class="token punctuation" style="margin: 0px; padding: 0px;">[path<span class="token punctuation" style="margin: 0px; padding: 0px;">] <span class="token operator" style="margin: 0px; padding: 0px;">= fn<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;

require<span class="token punctuation" style="margin: 0px; padding: 0px;">.relative <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function <span class="token punctuation" style="margin: 0px; padding: 0px;">(parent<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
  <span class="token keyword" style="margin: 0px; padding: 0px;">return <span class="token keyword" style="margin: 0px; padding: 0px;">function<span class="token punctuation" style="margin: 0px; padding: 0px;">(p<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">{
    <span class="token keyword" style="margin: 0px; padding: 0px;">if <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'.' <span class="token operator" style="margin: 0px; padding: 0px;">!<span class="token operator" style="margin: 0px; padding: 0px;">= p<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">charAt<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token number" style="margin: 0px; padding: 0px;">0<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token keyword" style="margin: 0px; padding: 0px;">return <span class="token function" style="margin: 0px; padding: 0px;">require<span class="token punctuation" style="margin: 0px; padding: 0px;">(p<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
    <span class="token keyword" style="margin: 0px; padding: 0px;">var path <span class="token operator" style="margin: 0px; padding: 0px;">= parent<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">split<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'/'<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
    <span class="token keyword" style="margin: 0px; padding: 0px;">var segs <span class="token operator" style="margin: 0px; padding: 0px;">= p<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">split<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'/'<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
    path<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">pop<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;

    <span class="token keyword" style="margin: 0px; padding: 0px;">for <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token keyword" style="margin: 0px; padding: 0px;">var i <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token number" style="margin: 0px; padding: 0px;">0<span class="token punctuation" style="margin: 0px; padding: 0px;">; i <span class="token operator" style="margin: 0px; padding: 0px;">&lt; segs<span class="token punctuation" style="margin: 0px; padding: 0px;">.length<span class="token punctuation" style="margin: 0px; padding: 0px;">; i<span class="token operator" style="margin: 0px; padding: 0px;">++<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
      <span class="token keyword" style="margin: 0px; padding: 0px;">var seg <span class="token operator" style="margin: 0px; padding: 0px;">= segs<span class="token punctuation" style="margin: 0px; padding: 0px;">[i<span class="token punctuation" style="margin: 0px; padding: 0px;">]<span class="token punctuation" style="margin: 0px; padding: 0px;">;
      <span class="token keyword" style="margin: 0px; padding: 0px;">if <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'..' <span class="token operator" style="margin: 0px; padding: 0px;">== seg<span class="token punctuation" style="margin: 0px; padding: 0px;">) path<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">pop<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
      <span class="token keyword" style="margin: 0px; padding: 0px;">else <span class="token keyword" style="margin: 0px; padding: 0px;">if <span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'.' <span class="token operator" style="margin: 0px; padding: 0px;">!<span class="token operator" style="margin: 0px; padding: 0px;">= seg<span class="token punctuation" style="margin: 0px; padding: 0px;">) path<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">push<span class="token punctuation" style="margin: 0px; padding: 0px;">(seg<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
    <span class="token punctuation" style="margin: 0px; padding: 0px;">}

    <span class="token keyword" style="margin: 0px; padding: 0px;">return <span class="token function" style="margin: 0px; padding: 0px;">require<span class="token punctuation" style="margin: 0px; padding: 0px;">(path<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">join<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">'/'<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用的时候，先将上面的代码放入页面。然后，将模块放在如下的立即执行函数里面，就可以调用了。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class="language-html" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
&lt;script src="require.js" /&gt;

&lt;script&gt;
require.register("moduleId", function(module, exports, require){
  // Module code goes here
});
var result = require("moduleId");
&lt;/script&gt;
</code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">还是以前面的 main.js 加载 foo.js 为例。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><pre class=" language-javascript" style="padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="margin: 0px; padding: 0px; font-family: 'Microsoft YaHei';"><code class=" language-javascript" style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">
require<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">register<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">"./foo.js"<span class="token punctuation" style="margin: 0px; padding: 0px;">, <span class="token keyword" style="margin: 0px; padding: 0px;">function<span class="token punctuation" style="margin: 0px; padding: 0px;">(module<span class="token punctuation" style="margin: 0px; padding: 0px;">, exports<span class="token punctuation" style="margin: 0px; padding: 0px;">, require<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">{
  module<span class="token punctuation" style="margin: 0px; padding: 0px;">.exports <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token keyword" style="margin: 0px; padding: 0px;">function<span class="token punctuation" style="margin: 0px; padding: 0px;">(x<span class="token punctuation" style="margin: 0px; padding: 0px;">) <span class="token punctuation" style="margin: 0px; padding: 0px;">{
    console<span class="token punctuation" style="margin: 0px; padding: 0px;">.<span class="token function" style="margin: 0px; padding: 0px;">log<span class="token punctuation" style="margin: 0px; padding: 0px;">(x<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
  <span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token punctuation" style="margin: 0px; padding: 0px;">}<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;

<span class="token keyword" style="margin: 0px; padding: 0px;">var foo <span class="token operator" style="margin: 0px; padding: 0px;">= <span class="token function" style="margin: 0px; padding: 0px;">require<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">"./foo.js"<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
<span class="token function" style="margin: 0px; padding: 0px;">foo<span class="token punctuation" style="margin: 0px; padding: 0px;">(<span class="token string" style="margin: 0px; padding: 0px;">"Hi"<span class="token punctuation" style="margin: 0px; padding: 0px;">)<span class="token punctuation" style="margin: 0px; padding: 0px;">;
</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></span></pre></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">注意，这个库只模拟了 require 、module 、exports 三个变量，如果模块还用到了 global 或者其他 Node 专有变量（比如 process），就通过立即执行函数提供即可。</span></p><p style="margin: 10px auto; padding: 0px;"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; font-size: 18pt;">二、AMD</span></strong></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">基于commonJS规范的nodeJS出来以后，服务端的模块概念已经形成<span style="margin: 0px; padding: 0px;">，</span></span><span style="margin: 0px; padding: 0px;">很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。</span><span style="margin: 0px; padding: 0px;">但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上面的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？</span></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　var math = require('math');</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　math.add(2, 3);</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">第二行math.add(2, 3)，在第一行require('math')之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">您会注意到&nbsp;<code style="margin-top: 0px; margin-bottom: 0px; padding: 0px;">require</code>&nbsp;是同步的。</span></strong></span></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于"假死"状态。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">因此，浏览器端的模块，不能采用"同步加载"（synchronous），只能采用"异步加载"（asynchronous）。这就是AMD规范诞生的背景。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">CommonJS是主要为了JS在后端的表现制定的，他是不适合前端的</span><span style="margin: 0px; padding: 0px; line-height: 1.5;">，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。</span></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">AMD</a>是"Asynchronous Module Definition"的缩写，意思就是"异步模块定义"。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">AMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require([module], callback);</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require(['math'], function (math) {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　math.add(2, 3);</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">math.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。</span><span style="margin: 0px; padding: 0px;">目前，主要有两个Javascript库实现了AMD规范：<a href="http://requirejs.org/" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">require.js</a>和<a href="https://github.com/cujojs/curl" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">curl.js</a>。</span></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong style="margin: 0px; padding: 0px;">RequireJS就是实现了AMD规范的呢。</strong></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);"><strong style="margin: 0px; padding: 0px;">详细概括：下面以RequireJS为例说明AMD规范</strong></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">一、为什么要用require.js？</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">最早的时候，所有Javascript代码都写在一个文件里面，只要加载这一个文件就够了。后来，代码越来越多，一个文件不够了，必须分成多个文件，依次加载。下面的网页代码，相信很多人都见过。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　&lt;script src="1.js"&gt;&lt;/script&gt;</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　&lt;script src="2.js"&gt;&lt;/script&gt;</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　&lt;script src="3.js"&gt;&lt;/script&gt;</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　&lt;script src="4.js"&gt;&lt;/script&gt;</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　&lt;script src="5.js"&gt;&lt;/script&gt;</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　&lt;script src="6.js"&gt;&lt;/script&gt;</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">这段代码依次加载多个js文件。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">这样的写法有很大的缺点。首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.js的诞生，就是为了解决这两个问题：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　<iframe id="iframe_0.18987848281052266" src="data:text/html;charset=utf8,<style>body{margin:0;padding:0}</style><img id=&quot;img&quot; src=&quot;http://image.beekka.com/blog/201211/bg2012110701.png?_=5856701&quot; style=&quot;border:none;max-width:848px&quot;><script>window.onload = function () {var img = document.getElementById('img'); window.parent.postMessage({iframeId:'iframe_0.18987848281052266',width:img.width,height:img.height}, 'http://www.cnblogs.com');}</script>" frameborder="0" scrolling="no" style="margin: 0px; padding: 0px; border-style: none; border-width: initial; width: 220px; height: 138px;"></iframe></span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　<span style="margin: 0px; padding: 0px;">（1）实现js文件的异步加载，避免网页失去响应；</span></span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　（2）管理模块之间的依赖性，便于代码的编写和维护。</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">二、require.js的加载</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用require.js的第一步，是先去官方网站<a href="http://requirejs.org/docs/download.html" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">下载</a>最新版本。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">下载后，假定把它放在js子目录下面，就可以加载了。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　&lt;script src="js/require.js"&gt;&lt;/script&gt;</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">有人可能会想到，加载这个文件，也可能造成网页失去响应。解决办法有两个，一个是把它放在网页底部加载，另一个是写成下面这样：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　&lt;script src="js/require.js"&nbsp;defer async="true"&nbsp;&gt;&lt;/script&gt;</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">async属性表明这个文件需要异步加载，避免网页失去响应。IE不支持这个属性，只支持defer，所以把defer也写上。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js，也放在js目录下面。那么，只需要写成下面这样就行了：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　&lt;script src="js/require.js"&nbsp;data-main="js/main"&gt;&lt;/script&gt;</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">data-main属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">三、主模块的写法</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">上一节的main.js，我把它称为"主模块"，意思是整个网页的入口代码。它有点像C语言的main()函数，所有代码都从这儿开始运行。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">下面就来看，怎么写main.js。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">如果我们的代码不依赖任何其他模块，那么可以直接写入javascript代码。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　// main.js</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　alert("加载成功！");</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">但这样的话，就没必要使用require.js了。真正常见的情况是，主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　// main.js</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require(['moduleA', 'moduleB', 'moduleC'], function (moduleA, moduleB, moduleC){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　// some code here</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require()函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是['moduleA', 'moduleB', 'moduleC']，即主模块依赖这三个模块；第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require()异步加载moduleA，moduleB和moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">下面，我们看一个实际的例子。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">假定主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require(['jquery', 'underscore', 'backbone'], function ($, _, Backbone){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　// some code here</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">四、模块的加载</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">上一节最后的示例中，主模块的依赖模块是['jquery', 'underscore', 'backbone']。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require.config({</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　paths: {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　"jquery": "jquery.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"underscore": "underscore.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"backbone": "backbone.min"</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录（js子目录）。如果这些模块在其他目录，比如js/lib目录，则有两种写法。一种是逐一指定路径。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require.config({</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　paths: {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　"jquery": "lib/jquery.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"underscore": "lib/underscore.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"backbone": "lib/backbone.min"</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">另一种则是直接改变基目录（baseUrl）。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require.config({</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　baseUrl: "js/lib",</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　paths: {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　"jquery": "jquery.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"underscore": "underscore.min",</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　"backbone": "backbone.min"</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">如果某个模块在另一台主机上，也可以直接指定它的网址，比如：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require.config({</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　paths: {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　"jquery": "https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min"</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.js要求，每个模块是一个单独的js文件。这样的话，如果加载多个模块，就会发出多次HTTP请求，会影响网页的加载速度。因此，require.js提供了一个<a href="http://requirejs.org/docs/optimization.html" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">优化工具</a>，当模块部署完毕以后，可以用这个工具将多个模块合并在一个文件中，减少HTTP请求数。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">五、AMD模块的写法</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">具体来说，就是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">假定现在有一个math.js文件，它定义了一个math模块。那么，math.js就要这样写：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　// math.js</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　define(function (){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　var add = function (x,y){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　return x+y;</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　};</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　return {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　add: add</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　};</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">加载方法如下：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　// main.js</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require(['math'], function (math){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　alert(math.add(1,1));</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　define(['myLib'], function(myLib){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　function foo(){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　myLib.doSomething();</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　return {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　foo : foo</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　};</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">六、加载非规范的模块</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">理论上，require.js加载的模块，必须是按照AMD规范、用define()函数定义的模块。但是实际上，虽然已经有一部分流行的函数库（比如jQuery）符合AMD规范，更多的库并不符合。那么，require.js是否能够加载非规范的模块呢？</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">回答是可以的。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">这样的模块在用require()加载之前，要先用require.config()方法，定义它们的一些特征。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require.config({</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　shim: {</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　'underscore':{</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　　　exports: '_'</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　},</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　'backbone': {</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　　　deps: ['underscore', 'jquery'],</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　　　exports: 'Backbone'</span><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.config()接受一个配置对象，这个对象除了有前面说过的paths属性之外，还有一个shim属性，专门用来配置不兼容的模块。具体来说，每个模块要定义（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">比如，jQuery的插件可以这样定义：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　shim: {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　'jquery.scroll': {</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　deps: ['jquery'],</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　exports: 'jQuery.fn.scroll'</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　}</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">七、require.js插件</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">require.js还提供一系列<a href="https://github.com/jrburke/requirejs/wiki/Plugins" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">插件</a>，实现一些特定的功能。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">domready插件，可以让回调函数在页面DOM结构加载完成后再运行。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　require(['domready!'], function (doc){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　// called once the DOM is ready</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　});</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">text和image插件，则是允许require.js加载文本和图片文件。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><blockquote style="margin-top: 0px; margin-bottom: 0px; padding: 5px 10px; border-style: none none none solid; border-left-width: 5px; border-left-color: rgb(221, 221, 221); border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; background: none;"><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　define([</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　'text!review.txt',</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　'image!cat.jpg'</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　],</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">　　　　function(review,cat){</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　console.log(review);</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　　　document.body.appendChild(cat);</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　　　}</span></p><p style="padding: 0px; color: rgb(119, 119, 119);"><span style="margin: 0px; padding: 0px;">　　);</span></p></blockquote><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">类似的插件还有json和mdown，用于加载json文件和markdown文件。（完）</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">另一个人的概括(有点简单)：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">AMD就只有一个接口：define(id?,dependencies?,factory);</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">它要在声明模块的时候制定所有的依赖(dep)，并且还要当做形参传到factory中，像这样：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><div class="cnblogs_code" style="margin-top: 5px; margin-bottom: 5px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important; background-color: rgb(245, 245, 245);"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Microsoft YaHei'; font-size: 16px !important;"><span style="margin: 0px; padding: 0px; font-family: 幼圆; line-height: 1.5 !important;">1 define(['dep1','dep2'],function(dep1,dep2){...});</span></pre></div><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">要是没什么依赖，就定义简单的模块，下面这样就可以啦：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><div class="cnblogs_code" style="margin-top: 5px; margin-bottom: 5px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important; background-color: rgb(245, 245, 245);"><div class="cnblogs_code_toolbar" style="margin-top: 5px; padding: 0px;"><span class="cnblogs_code_copy" style="margin: 0px; padding: 0px 5px 0px 0px; font-family: &quot;Microsoft YaHei&quot;; font-size: 16px !important; line-height: 1.5 !important;"><a title="复制代码" style="margin: 0px; padding: 0px; text-decoration: underline; border: none !important;"><img src="彻底弄懂CommonJS和AMD-CMD！_files/0.5677710583410547.png" alt="复制代码" style="margin-top: 0px; margin-bottom: 0px; padding: 0px; max-width: 800px; border-style: none !important; border-width: initial !important;"></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Microsoft YaHei'; font-size: 16px !important;"><span style="margin: 0px; padding: 0px; font-family: 幼圆; line-height: 1.5 !important;">1 define(function(){
2     var exports = {};
3     exports.method = function(){...};
4     return exports;
5 });</span></pre><div class="cnblogs_code_toolbar" style="margin-top: 5px; padding: 0px;"><span class="cnblogs_code_copy" style="margin: 0px; padding: 0px 5px 0px 0px; font-family: &quot;Microsoft YaHei&quot;; font-size: 16px !important; line-height: 1.5 !important;"><a title="复制代码" style="margin: 0px; padding: 0px; text-decoration: underline; border: none !important;"><img src="彻底弄懂CommonJS和AMD-CMD！_files/0.7777171797464224.png" alt="复制代码" style="margin-top: 0px; margin-bottom: 0px; padding: 0px; max-width: 800px; border-style: none !important; border-width: initial !important;"></a></span></div></div><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">咦，这里有define，把东西包装起来啦，那Node实现中怎么没看到有define关键字呢，它也要把东西包装起来呀，其实吧，只是Node隐式包装了而已.....</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-family: 幼圆;">这有AMD的WIKI中文版，讲了很多蛮详细的东西，用到的时候可以查看：<a href="https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88)" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">AMD的WIKI中文版</a></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px; font-size: 18pt;"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">三、CMD</span></strong></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">大名远扬的玉伯写了seajs，就是遵循他提出的CMD规范，与AMD蛮相近的，不过用起来感觉更加方便些，最重要的是中文版，应有尽有：<a href="http://seajs.org/docs/#docs" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">seajs官方doc</a></span></p><div class="cnblogs_code" style="margin-top: 5px; margin-bottom: 5px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: 'Courier New' !important; font-size: 12px !important; background-color: rgb(245, 245, 245);"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Microsoft YaHei'; font-size: 16px !important;"><span style="margin: 0px; padding: 0px; line-height: 1.5 !important;">1 define(function(require,exports,module){...});</span></pre></div><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">用过seajs吧，这个不陌生吧，对吧。</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">前面说AMD，说RequireJS实现了AMD，CMD看起来与AMD好像呀，那RequireJS与SeaJS像不像呢？</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">虽然CMD与AMD蛮像的，但区别还是挺明显的，官方非官方都有阐述和理解，我觉得吧，说的都挺好：</span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><a href="https://github.com/seajs/seajs/issues/277" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">官方阐述SeaJS与RequireJS异同</a></span></p><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;"><a href="http://www.douban.com/note/283566440/" target="_blank" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0);">SeaJS与RequireJS的最大异同（这个说的也挺好）</a></span></p></div></div></div><!--WizHtmlContentEnd-->

</div>
</body>

</html>